$(function(){$("#tg").treegrid({onClickCell:function(b,d){if(b=="NAME"){var a=d.ID;if(TARGET_ID==null||TARGET_ID.length==0){var c="";if(TARGET_TYPE=="R"){c="角色"}else{if(TARGET_TYPE=="U"){c="用户"}}if(TARGET_TYPE=="D"){c="部门"}if(TARGET_TYPE=="G"){c="群组"}if(TARGET_TYPE=="P"){c="岗位"}$.messager.alert("提示","请选择一个"+c+"！","info");return}findComponentResources(a)}}})});function refreshMenuSecurityCache(){$.messager.confirm("系统","真的要刷新菜单资源的权限信息吗？",function(a){if(a){$.ajax({url:"platform/cc/componentmanager/refreshComponentAuthority/"+_APPID+".json",type:"POST",dataType:"json",success:function(b){if(b.flag=="success"){$.messager.show({title:"提示",msg:"刷新菜单授权缓存成功。",timeout:2000,showType:"slide"})}else{$.messager.show({title:"提示",msg:b.e,timeout:2000,showType:"slide"})}},error:function(b,d,c){alert(b.status);alert(d);alert(b.readyState)}})}})}function checkboxOnclick(e){var f=$(e);var c=f.parent().parent().parent().parent().attr("node-id");var a=f.parent().parent().parent().parent();var b=false;if(f.hasClass("tree-checkbox1")){b=true}changCheck(b,f);var d=a.next();if(!d.attr("node-id")){a.next().find(".tree-checkbox").each(function(){changCheck(b,$(this))})}}function changCheck(a,b){if(a){b.removeClass("tree-checkbox0 tree-checkbox1");b.addClass("tree-checkbox0")}else{b.removeClass("tree-checkbox0 tree-checkbox1");b.addClass("tree-checkbox1")}}function formatCheckBox(b,a,c){if(a.checked){return"<span class='tree-checkbox tree-checkbox1' onclick='checkboxOnclick(this);'></span>"+b}else{return"<span class='tree-checkbox tree-checkbox0' onclick='checkboxOnclick(this);'></span>"+b}}function onClickRow(){var a=$("#tg").treegrid("getSelected");if(!a||!a.ID){window.MENU_ID="";return}window.MENU_ID=a.ID;if(!window.MENU_ID){return}window.MENU_EVEL=$("#tg").treegrid("getLevel",window.MENU_ID)}function selectOneRow(){findComponentResources(window.MENU_ID);if(!window.MENU_ID){return}try{if("1"==window.MENU_ID){$("#tg").treegrid("expandAll",window.MENU_ID)}$("#tg").treegrid("select",window.MENU_ID)}catch(a){}}function remarkformat(b,a,c){if("1"==b){return"<img src='static/images/platform/sysmenuaccesscontrol/ok.png' title='允许访问' onclick='window.changeSingleMenuAuth(this);' alt="+a.ID+">"}if("0"==b){return"<img src='static/images/platform/sysmenuaccesscontrol/no.gif' title='禁止访问' onclick='window.changeSingleMenuAuth(this);' alt="+a.ID+">"}return"<img src='static/images/platform/sysmenuaccesscontrol/untitled.png' title='未设置权限' onclick='window.changeSingleMenuAuth(this);' alt="+a.ID+">"}function initForSearch(){$("#formSearch").searchbox({width:200,searcher:function(a){if(null==a||""==a){$("#tg").treegrid("options").url="platform/cc/componentmanager/getSysMenusByParentId.json";$("#tg").treegrid("load",{targetType:window.TARGET_TYPE,targetId:window.TARGET_ID,level:window.MENU_EVEL,appId:_APPID})}else{$("#tg").treegrid("options").url="platform/cc/componentmanager/searchMenu.json";$("#tg").treegrid("load",{search_name:a,targetType:window.TARGET_TYPE,targetId:window.TARGET_ID,level:window.MENU_EVEL,appId:_APPID})}},prompt:"请输入菜单名称！"})}$(document).ready(function(){initForSearch()});window.loadAuthInfoData=function(){$("#tg").treegrid("options").url="platform/cc/componentmanager/getSysMenusByParentId.json";$("#tg").treegrid("load",{targetType:window.TARGET_TYPE,targetId:window.TARGET_ID,level:window.MENU_EVEL,appId:_APPID})};window.changeSingleMenuAuth=function(d){var c=d.alt;if(!c){return}$("#tg").treegrid("select",c);var b=$("#tg").treegrid("getSelected");if(!b){return}if(!window.window.TARGET_TYPE||!window.TARGET_ID){$.messager.alert("系统","请选择被授权的对象！","info");return}var f=b._parentId;window.MENU_ID=c;var e="";var a=b.REMARK;if("0"==a){e="del"}else{if("1"==a){e="0"}else{e="1"}}$.messager.confirm("系统","确认要修改此项权限吗？",function(g){if(g){$.ajax({url:"platform/cc/componentmanager/saveSingleSetAuth.json",type:"POST",dataType:"json",data:{targetType:window.TARGET_TYPE,targerId:window.TARGET_ID,menuId:c,operType:e,appId:_APPID},success:function(h){if(!h||"success"!=h.flag){return}if(h.returnP){$("#tg").treegrid("reload",f)}else{if(f){$("#tg").treegrid("reload",f)}else{$("#tg").treegrid("reload",c)}}$.messager.show({title:"提示",msg:"授权修改成功。",timeout:2000,showType:"slide"})},error:function(h,j,i){alert(h.status);alert(j);alert(h.readyState)}})}})};window.changeBatchMenuAuth=function(c){if(!window.window.TARGET_TYPE||!window.TARGET_ID){$.messager.alert("系统","请选择被授权的对象！","info");return}var b=$("#tg").treegrid("getSelected");if(!b){$.messager.alert("系统","请选择菜单！","info");return}var a=b.ID;$.messager.confirm("系统","确认要批量修改所有子结点的权限吗？",function(d){if(d){$.ajax({url:"platform/cc/componentmanager/saveBatchSetAuth.json",type:"POST",dataType:"json",data:{targetType:window.TARGET_TYPE,targerId:window.TARGET_ID,menuId:a,operType:c,appId:_APPID},success:function(e){if(!e||"success"!=e.flag){return}$("#tg").treegrid("select",a);var f=$("#tg").treegrid("getSelected");if(!f){return}var g=f._parentId;if(g){$("#tg").treegrid("reload",g)}else{$("#tg").treegrid("reload")}$.messager.show({title:"提示",msg:"授权批量修改成功。",timeout:2000,showType:"slide"})},error:function(e,g,f){alert(e.status);alert(g);alert(e.readyState)}})}})};function findComponentResources(c,d){var a=$("#componentsDataGrid");var b=a.datagrid("options").queryParams;if(c==null||typeof(c)=="undefined"){c="1"}b.urlId=c;b.targetType=TARGET_TYPE;b.targetId=TARGET_ID;b.queryKeyWord=d;a.datagrid("options").queryParams=b;a.datagrid("load");$(".searchbox-text:eq(2)").val("")};